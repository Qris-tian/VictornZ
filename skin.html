<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pasang Skin + Sidebar</title>
  
  <!-- CSS Skin -->
  <link rel="stylesheet" href="skin.css">
</head>
<body>

<!-- HEADER -->
<div class="header">
  <div class="menu-btn" id="menuBtn">☰</div>
  <h2>Pasang Skin</h2>
</div>

<!-- Sidebar -->
<div class="sidebar" id="sidebar">
  <div class="sidebar-header">
    <img src="logo.png" alt="Logo Victornz" class="sidebar-logo">
    <h2>Victornz</h2>
  </div>
  <hr class="sidebar-divider">
  <nav class="sidebar-menu">
    <a href="beranda.html">
      <img src="house.png" alt="Home Icon" class="icon"><span>Beranda</span>
    </a>
    <a href="rules.html">
      <img src="book-text.png" alt="Rules Icon" class="icon"><span>Rules</span>
    </a>
    <a href="list.html">
      <img src="clipboard-list.png" alt="List Icon" class="icon"><span>List Member</span>
    </a>
    <a href="fotbar.html">
      <img src="camera.png" alt="Fotbar Icon" class="icon"><span>Fotbar</span>
    </a>
    <a href="build.html">
      <img src="image.png" alt="Build Icon" class="icon"><span>Hasil Build</span>
    </a>
    <a href="skin.html" class="active">
      <img src="shirt.png" alt="Skin Icon" class="icon"><span>Pasang Skin</span>
    </a>
    <a href="pesan.html">
      <img src="message-square-more.png" alt="Pesan Icon" class="icon"><span>Pesan</span>
    </a>
  </nav>
  <div class="sidebar-footer">
    <p>© 2025 Victornz</p>
  </div>
</div>
<!-- KONTEN PASANG SKIN -->
<div class="content">
  <h1><b>Pasang Template</b></h1>
  <div class="ytta">
    <label><b>Pilih model:</b></label>
    <select id="model">
      <option value="steve">Steve (Wide)</option>
      <option value="alex">Alex (Slim)</option>
    </select>
  </div>
  <div class="ytta">
    <label><b>Upload Skin :</b></label>
    <input type="file" id="skinInput" accept="image/png"><br>
  </div>
  <button id="processBtn">Pasang Baju</button>
  <button id="downloadBtn" disabled>Download Skin </button>

  <div id="progressContainer">
    <div id="progressBar"></div>
  </div>
  <div id="statusText"></div>

  <canvas id="canvas" width="64" height="64"></canvas>
</div>

<!-- SCRIPT SIDEBAR -->
<script>
const sidebar = document.getElementById('sidebar');
const menuBtn = document.getElementById('menuBtn');

menuBtn.addEventListener('click', (e) => {
  e.stopPropagation();
  sidebar.classList.toggle('active');
});

document.addEventListener('click', (e) => {
  const isInsideSidebar = sidebar.contains(e.target);
  const isMenuBtn = menuBtn.contains(e.target);
  if (!isInsideSidebar && !isMenuBtn) {
    sidebar.classList.remove('active');
  }
});

document.querySelectorAll('.sidebar a').forEach(link => {
  link.addEventListener('click', () => {
    sidebar.classList.remove('active');
  });
});
</script>

<!-- SCRIPT PASANG SKIN -->
<script>
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");
const skinInput = document.getElementById("skinInput");
const processBtn = document.getElementById("processBtn");
const downloadBtn = document.getElementById("downloadBtn");
const modelSelect = document.getElementById("model");
const progressContainer = document.getElementById("progressContainer");
const progressBar = document.getElementById("progressBar");
const statusText = document.getElementById("statusText");

const outfitImg = new Image();
outfitImg.src = "./template.png";

outfitImg.onerror = () => {
  statusText.textContent = "❌ Gagal memuat template.png. Pastikan file ada di folder yang sama.";
};

function readFile(input, callback) {
  if (input.files && input.files[0]) {
    const reader = new FileReader();
    reader.onloadstart = () => updateProgress(10, "Membaca file skin...");
    reader.onprogress = e => {
      if (e.lengthComputable) {
        const percent = Math.min(10 + (e.loaded / e.total) * 20, 30);
        updateProgress(percent, "Membaca skin...");
      }
    };
    reader.onload = e => callback(e.target.result);
    reader.readAsDataURL(input.files[0]);
  }
}

function updateProgress(percent, text) {
  progressContainer.style.display = "block";
  progressBar.style.width = percent + "%";
  statusText.textContent = text;
}

processBtn.onclick = () => {
  if (!skinInput.files[0]) {
    alert("Silakan upload file skin dulu!");
    return;
  }

  downloadBtn.disabled = true;
  updateProgress(0, "Menyiapkan...");

  const model = modelSelect.value;
  readFile(skinInput, (skinSrc) => {
    const skinImg = new Image();

    skinImg.onload = () => {
      updateProgress(60, "Memuat skin...");
      outfitImg.onload = () => {
        updateProgress(80, "Menggabungkan...");

        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.drawImage(skinImg, 0, 0);

        if (model === "steve") {
          ctx.clearRect(16, 32, 24, 16);
          ctx.clearRect(40, 32, 16, 16);
          ctx.clearRect(48, 48, 16, 16);
        } else {
          ctx.clearRect(16, 32, 24, 16);
          ctx.clearRect(36, 32, 12, 16);
          ctx.clearRect(44, 48, 12, 16);
        }

        ctx.drawImage(outfitImg, 0, 0);
        updateProgress(100, "✅ Selesai! Klik Download");
        downloadBtn.disabled = false;
      };
      outfitImg.src = "./template.png";
    };

    skinImg.onerror = () => {
      updateProgress(0, "❌ File skin tidak valid.");
    };

    updateProgress(40, "Memuat gambar skin...");
    skinImg.src = skinSrc;
  });
};

downloadBtn.onclick = () => {
  const link = document.createElement("a");
  link.download = "hasil.png";
  link.href = canvas.toDataURL("image/png");
  link.click();
};
</script>

</body>
</html>